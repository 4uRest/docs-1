# Телефония

Телефония нужна ресторанам у которых есть свой call центр и которые принимают заказы о доставке. Интеграция должна упрощать ввод данных клиента в базу ресторана и делать работу оператора более персональной. Например, когда звонит уже известный номер, к клиенту можно обратиться по имени, сказать его последний адрес доставки и заказ.  

Пример хорошей интеграции с телефонией — [приложение Binotel](https://joinposter.com/applications/binotel).

<iframe width="560" height="315" src="https://www.youtube.com/embed/ov5ajG8-9g4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


## Подключение

Чтобы получить доступ к аккаунту Poster через API, клиент должен пройти [oAuth авторизацию](/docs/v3/start/authApi), после которой вы получите токен доступа. 
После oAuth в Poster, авторизуйте клиента в вашей системе, таким образом вы поймете какому аккаунту Poster соответствует аккаунт в вашей системе.


## Настройка линий

В телефонии звонки распределяются по линиям, и каждому сотруднику присваивается своя линия.

В Poster тоже есть сотрудники, поэтому вам нужно присвоить каждому сотруднику свою линию. Вы можете сделать это в вашем интерфейсе, но лучше сделать окно настроек в админ-панели Poster. Для этого используйте [Manage платформу](/docs/v3/manage/index).


## Работа на кассе

Кассу дополняют функциями при помощи [POS платформы](/docs/v3/pos/index). Чтобы начать разработку посмотрите раздел [Начало работы](/docs/v3/pos/start).

Давайте разберем такой сценарий:
В заведении оператор принимает звонки на доставку. 
Клиент первый раз звонит, чтобы заказать пиццу в офис. Оператору call центра нужно:


* Узнать имя гостя
* Узнать номер телефона
* Заполнить заказ
* Указать адрес для доставки


1. При запуске кассы получайте текущего сотрудника методом [Poster.users.getActiveUser](/docs/v3/pos/users/users-getActiveUser) и по extras смотрите его входящую линию.

☝️ За одной кассой работает несколько официантов. Методом [Poster.on](/docs/v3/pos/events/index) подписываетесь на событие входа кассира [userLogin](/docs/v3/pos/events/userLogin) и меняете текущую линию сотрудника.

2. Установите соединение по веб-сокету со своим сервером и слушаете входящие звонки. Методом [Poster.makeRequest](/docs/v3/pos/requests/makeRequest) делаете кросс-доменные запросы к себе на сервер.

3. Во время входящего звонка, покажите всплывающее окно методом [Poster.interface.popup](/docs/v3/pos/interfaces/interface-popup). В этом окне нужно дать возможность: a) Заполнить контакты клиента и быстро создать новый заказа. b) Показать контакты клиента и быстро создать новый заказ

4. Во время входящего звонка ищите клиента по номеру телефона методом [Poster.clients.find](/docs/v3/pos/clients/clients-find).

5. Если клиента нет в базе Poster, сделайте форму для быстрого создания. Используйте метод [Poster.clients.create](/docs/v3/pos/clients/clients-create). В форме обязательно должны быть:


* Имя
* Клиентская группа. Получайте все группы методом [clients.getGroups](/docs/v3/web/clients/getGroups).
* Номер телефна. Должен автоматом заполняться.
* Адрес


6. Создавайте новый заказ методом [Poster.orders.create](/docs/v3/pos/orders/orders-create) и добавляйте в него клиента методом [Poster.orders.setOrderClient](/docs/v3/pos/orders/orders-setOrderClient).
